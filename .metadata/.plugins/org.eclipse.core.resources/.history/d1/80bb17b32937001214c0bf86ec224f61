package com.example.datamanager;

import android.app.Service;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.content.SharedPreferences;
import android.os.IBinder;
import android.widget.Toast;

public class MainService extends Service {

	@Override
	public IBinder onBind(Intent arg0) {
		// TODO Auto-generated method stub
		return null;
	}

	public void onCreate() {

		super.onCreate();

		// REGISTER RECEIVER THAT HANDLES SCREEN ON AND SCREEN OFF LOGIC

		IntentFilter filter = new IntentFilter(Intent.ACTION_SCREEN_ON);

		filter.addAction(Intent.ACTION_SCREEN_OFF);

		BroadcastReceiver mReceiver = new ScreenReceiver();

		registerReceiver(mReceiver, filter);

	}

	// when service starts
	public int onStartCommand(Intent intent, int flags, int startId) {

		boolean screenOn = intent.getBooleanExtra("screen_state", false);

		if (screenOn) {

		} else {

			// test purposes
			try {
				loopTaosts();
			} catch (InterruptedException e) {
				Toast.makeText(getBaseContext(), "Erreur", Toast.LENGTH_SHORT)
						.show();
				e.printStackTrace();
			}
		}

		return super.onStartCommand(intent, flags, startId);
	}

	public void loopTaosts() throws InterruptedException {

		// fetching preferences
		SharedPreferences dataManagerSettings = getSharedPreferences(
				MainActivity.PREFERENCE_NAME, Context.MODE_PRIVATE);
		int timeOn = dataManagerSettings.getInt(MainActivity.STR_TIME_ON,
				MainActivity.TIME_ON);
		int timeOff = dataManagerSettings.getInt(MainActivity.STR_TIME_OFF,
				MainActivity.TIME_OFF);

		// data handler
		DataHandler dataHandler = new DataHandler(getBaseContext(), timeOn,
				timeOff);

		// launch thread
		Thread dataThread = new Thread(new DataUsage(dataHandler));
		dataThread.start();
	}

	/**
	 * Determines wether screen is on or not
	 */

}
